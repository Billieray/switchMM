---
-   hosts: localhost
    gather_facts: no

    vars:
     switch_list:
      - 10.22.22.1
      - 10.22.22.2
      - 10.22.22.3
      - 10.22.22.4
      - 10.22.22.5

    tasks:

    - name: get_PortSummary_from_ALL_devices_from_PRIME
      uri:
        url: https://10.23.77.200/webacs/api/v4/op/statisticsService/device/portSummary.json?ipAddress={{ item }}
        validate_certs: no
        method: GET
        return_content: yes
        headers:
            Content-Type: "application/json"
        user: devnet
        password: Maticmind2018
        force_basic_auth: yes
      with_items: "{{switch_list}}"
      register: device_facts

    - name: Show Collected Data
      debug:
            var: device_facts.results


    - name: parse the JSON output from CPI and save it in a new dictionary
      set_fact: 
         All_Port_Status_json: "{{device_facts.results | from_json }}"

    - debug:
        msg: "{{All_Port_Status_json}}"

#    - name: Get specific Values from JSON
#      set_fact:
#        Down_IFs: "{{Down_IFs| default([]) + [item] }}"
#      with_items: "{{
#                    device_facts.results|
#                        json_query('[*].json.queryResponse.entity[0].\"inventoryDetailsDTO\".\"ethernetInterfaces\".ethernetInterface[*].\"operationalStatus\"')
#                    }}"

#    - debug:
#            var: Down_IFs


                                    
#      
#    - name: get_switch_IPaddress
#         switch_IP: "{{switch_IPaddress.matches.0.address}}"
#         switch_Interface: "{{switch_If.matches.0.clientInterface}}"
#         switch_hostname: "{{switch_name.matches.0.deviceName}}"
#
